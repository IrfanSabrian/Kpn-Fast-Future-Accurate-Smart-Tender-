<html>
<head>
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta charset="UTF-8">
    <title>KPN FAST Manager</title>
    <HTA:APPLICATION
        ID="KPN_FAST"
        APPLICATIONNAME="KPN FAST Manager"
        BORDER="dialog"
        BORDERSTYLE="normal"
        CAPTION="yes"
        ICON="Logo.ico"
        MAXIMIZEBUTTON="no"
        MINIMIZEBUTTON="yes"
        SHOWINTASKBAR="yes"
        SINGLEINSTANCE="yes"
        SYSMENU="yes"
        SCROLL="no"
        WINDOWSTATE="normal"
    />
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background-color: #121212; 
            color: #e0e0e0;
            padding: 0; 
            overflow: hidden; 
            font-size: 14px; 
        }
        .container { 
            background-color: #1e1e1e; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
        }
        .header { 
            background: linear-gradient(135deg, #0d47a1 0%, #1565c0 100%); 
            padding: 15px; 
            display: flex; 
            align-items: center; 
            gap: 15px; 
            color: white; 
            border-bottom: 1px solid #333;
        }
        .logo { 
            width: 50px; 
            height: 50px; 
            background: white; 
            border-radius: 50%; 
            padding: 3px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.3); 
        }
        .header-text { display: flex; flex-direction: column; }
        h1 { font-size: 18px; font-weight: 700; margin: 0; color: white; }
        .subtitle { font-size: 11px; opacity: 0.8; color: #bbdefb; }
        
        .content { flex: 1; padding: 15px; overflow-y: auto; }
        
        .server-card { 
            background-color: #2d2d2d; 
            border: 1px solid #424242; 
            border-radius: 8px; 
            padding: 12px; 
            margin-bottom: 12px; 
            display: flex; 
            align-items: center; 
            justify-content: space-between; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.2); 
        }
        .server-card.running { border-left: 4px solid #4caf50; }
        .server-card.stopped { border-left: 4px solid #f44336; }
        .server-card.loading { border-left: 4px solid #ff9800; }
        
        .server-info { flex: 1; }
        .server-name { font-weight: 600; font-size: 14px; color: #ffffff; display: block; margin-bottom: 2px; }
        .server-status { font-size: 11px; font-weight: 600; padding: 2px 6px; border-radius: 4px; display: inline-block; }
        
        .status-running { background: #1b5e20; color: #a5d6a7; }
        .status-stopped { background: #b71c1c; color: #ffcdd2; }
        .status-loading { background: #e65100; color: #ffe0b2; }
        
        .controls { display: flex; gap: 8px; }
        .btn-icon { 
            width: 32px; 
            height: 32px; 
            border: none; 
            border-radius: 6px; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 14px; 
            transition: all 0.2s; 
        }
        .btn-start { background: #2e7d32; color: white; }
        .btn-start:hover { background: #388e3c; }
        .btn-stop { background: #c62828; color: white; }
        .btn-stop:hover { background: #d32f2f; }
        .btn-browser { background: #1565c0; color: white; }
        .btn-browser:hover { background: #1976d2; }
        
        .message-area { 
            margin-top: 15px; 
            padding: 10px; 
            background: #252525; 
            border-radius: 6px; 
            font-size: 12px; 
            color: #bdbdbd; 
            text-align: center; 
            border: 1px solid #333; 
            font-family: monospace;
        }

        .footer-controls {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        .btn-footer {
            background: #424242;
            color: white;
            border: 1px solid #616161;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        .btn-footer:hover { background: #616161; }
    </style>
    
    <script type="text/javascript">
        var shell = new ActiveXObject("WScript.Shell");
        var backendRunning = false;
        var frontendRunning = false;

        function resizeWindow() {
            window.resizeTo(400, 550);
            window.moveTo((screen.width - 400) / 2, (screen.height - 550) / 2);
        }

        function updateUI(server, status, text) {
            var card = document.getElementById("card" + server);
            var statusSpan = document.getElementById("status" + server);
            var btn = document.getElementById("btn" + server);
            
            if (card) card.className = "server-card " + status;
            if (statusSpan) {
                statusSpan.className = "server-status status-" + status;
                statusSpan.innerText = text;
            }
            
            if (btn) {
                if (status === "running") {
                    btn.className = "btn-icon btn-stop";
                    btn.innerHTML = "&#9632;"; // Square stop icon
                    btn.title = "Stop " + server;
                    btn.onclick = function() { toggleServer(server); };
                } else {
                    btn.className = "btn-icon btn-start";
                    btn.innerHTML = "&#9658;"; // Play icon
                    btn.title = "Start " + server;
                    btn.onclick = function() { toggleServer(server); };
                }
            }
        }

        function updateMessage(msg) {
            document.getElementById("message").innerText = "> " + msg;
        }

        function toggleServer(server) {
            if (server === "Backend") {
                if (backendRunning) stopBackend(); else runBackend();
            } else if (server === "Frontend") {
                if (frontendRunning) stopFrontend(); else runFrontend();
            }
        }

        function runBackend() {
            try {
                // Use title to identify window later
                shell.Run('cmd /c start "KPN FAST - Backend" cmd /k "cd backend && npm run dev"', 1, false);
                backendRunning = true;
                updateUI("Backend", "running", "RUNNING");
                updateMessage("Backend starting...");
            } catch (e) {
                updateUI("Backend", "stopped", "ERROR");
                updateMessage("Error starting Backend: " + e.message);
            }
        }

        function stopBackend() {
            try {
                // Kill cmd window with specific title, /T kills child processes (node)
                shell.Run('taskkill /F /FI "WINDOWTITLE eq KPN FAST - Backend*" /IM cmd.exe /T', 0, false);
                backendRunning = false;
                updateUI("Backend", "stopped", "STOPPED");
                updateMessage("Backend stopped.");
            } catch (e) {
                updateMessage("Error stopping Backend: " + e.message);
            }
        }

        function runFrontend() {
            try {
                shell.Run('cmd /c start "KPN FAST - Frontend" cmd /k "cd frontend && npm run dev"', 1, false);
                frontendRunning = true;
                updateUI("Frontend", "running", "RUNNING");
                updateMessage("Frontend starting...");
            } catch (e) {
                updateUI("Frontend", "stopped", "ERROR");
                updateMessage("Error starting Frontend: " + e.message);
            }
        }

        function stopFrontend() {
            try {
                shell.Run('taskkill /F /FI "WINDOWTITLE eq KPN FAST - Frontend*" /IM cmd.exe /T', 0, false);
                frontendRunning = false;
                updateUI("Frontend", "stopped", "STOPPED");
                updateMessage("Frontend stopped.");
            } catch (e) {
                updateMessage("Error stopping Frontend: " + e.message);
            }
        }

        function openBrowser() {
            try {
                shell.Run("http://localhost:3000");
                updateMessage("Browser opened.");
            } catch (e) {
                updateMessage("Error opening browser: " + e.message);
            }
        }

        function startAll() {
            resizeWindow();
            updateMessage("Initializing...");
            
            // Start Backend
            updateUI("Backend", "loading", "STARTING...");
            setTimeout(function() {
                runBackend();
            }, 1000);

            // Start Frontend after 3 seconds
            setTimeout(function() {
                updateUI("Frontend", "loading", "STARTING...");
                runFrontend();
            }, 3000);

            // Open Browser after 8 seconds
            setTimeout(function() {
                openBrowser();
                updateMessage("All systems go.");
            }, 8000);
        }
    </script>
</head>
<body onload="startAll()">
    <div class="container">
        <div class="header">
            <img src="Logo.ico" class="logo">
            <div class="header-text">
                <h1>KPN FAST</h1>
                <div class="subtitle">Manager</div>
            </div>
        </div>
        <div class="content">
            <!-- Backend Card -->
            <div class="server-card loading" id="cardBackend">
                <div class="server-info">
                    <span class="server-name">Backend Server</span>
                    <span class="server-status status-loading" id="statusBackend">WAITING...</span>
                </div>
                <div class="controls">
                    <button class="btn-icon btn-start" id="btnBackend" title="Start Backend" onclick="toggleServer('Backend')">&#9658;</button>
                </div>
            </div>

            <!-- Frontend Card -->
            <div class="server-card loading" id="cardFrontend">
                <div class="server-info">
                    <span class="server-name">Frontend Server</span>
                    <span class="server-status status-loading" id="statusFrontend">WAITING...</span>
                </div>
                <div class="controls">
                    <button class="btn-icon btn-start" id="btnFrontend" title="Start Frontend" onclick="toggleServer('Frontend')">&#9658;</button>
                </div>
            </div>

            <!-- Browser Card -->
            <div class="server-card running" id="cardBrowser" style="border-left-color: #1976d2;">
                <div class="server-info">
                    <span class="server-name">Web Application</span>
                    <span class="server-status" style="background: #1565c0; color: white;">http://localhost:3000</span>
                </div>
                <div class="controls">
                    <button class="btn-icon btn-browser" title="Open Browser" onclick="openBrowser()">&#8599;</button>
                </div>
            </div>

            <div class="message-area" id="message">Ready...</div>
            
            <div class="footer-controls">
                <button class="btn-footer" onclick="startAll()">Restart All</button>
                <button class="btn-footer" onclick="window.close()">Close</button>
            </div>
        </div>
    </div>
</body>
</html>
